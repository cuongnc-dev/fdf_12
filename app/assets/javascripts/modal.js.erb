$(document).ready(function(){
  var price = 0;
  var product = null;
  $('.btn_modal_order_now').click(function(){
    product = $(this).data('product');
    price = product.price;
    document.getElementById("modal_image").src = product.image.url;
    $('#modal_name').html(product.name);
    $('#modal_price').html(price.toLocaleString() + I18n.t("cart.vnd"));
    var quantity = $('#modal_quantity').html('1');
    $('#modal_total').html(price.toLocaleString() + I18n.t("cart.vnd"));
  });

  $('.modal_quantity_up').click(function(){
    var quantity = parseInt($('#modal_quantity').html());
    if(quantity < 30){
      $('#modal_quantity').html(quantity + 1);
      $('#modal_total').html(((quantity + 1) * price).toLocaleString() + I18n.t("cart.vnd"));
    }
  });

  $('.modal_quantity_down').click(function(){
    var quantity = parseInt($('#modal_quantity').html());
    if(quantity > 1) {
      $('#modal_quantity').html(quantity - 1);
      $('#modal_total').html(((quantity - 1) * price).toLocaleString() + I18n.t("cart.vnd"));
    }
  });

  $('#finish_order_fast').click(function(){
    var quantity = $('#modal_quantity').html();
    var note = $('#modal_note').val();
    $.ajax({
      type: 'POST',
      url : '/order_fasts',
      dataType: 'json',
      context: this,
      data: {
        product_id: product.id,
        note: note,
        quantity: quantity
      },
      success: function(response) {
        if(response.url == '') {
          window.location.reload();
        }
        else {
          window.location = response.url;
        }
      },
      error: function(errors) {
        window.location.reload();
      }
    });
  });
});

$(document).ready(function(){
  $('.update_notes_cart').click(function(){
    $(this).closest('.hide_show').find('.content_note_item_cart').slideToggle(800);
  });

  $('.content_note_cancel').click(function(){
    $(this).closest('.hide_show').find('.content_note_item_cart').slideToggle(800);
  });

  $('.content_note_save').click(function(){
    var note = $(this).closest('.content_note_item_cart').find('.content_note').val();
    var domain_id = $(this).closest('.cart-item-show').data('id');
    var product_id = $(this).closest('a').data('id');
    $.ajax({
      type: 'PUT',
      url : '/carts/1',
      dataType: 'json',
      context: this,
      data: {
        type_notes: "notes",
        product_id: product_id,
        notes: note
      },
      success: function(response) {
        $(this).closest('.content_note_item_cart').hide(800);
      },
      error: function(errors) {
        alert(I18n.t('order_quick.save_fail'));
      }
    });
  });
});

$(document).ready(function(){
  $('#search').keyup(function(){
    $('#search_owner_form').submit();
  });
});

$(document).ready(function() {
  $('input[type=radio][name=filter_order]').change(function() {
    $(this).parent('a').get(0).click();
  });
});
